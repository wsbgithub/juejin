# å‰è¨€

åœ¨ç¬¬ä¸€ç« ï¼Œæˆ‘ä»¬å·²ç»å¤§è‡´äº†è§£è¿‡ `CI/CD`Â çš„ä½œç”¨å’Œå†å²ã€‚ä»è¿™ä¸€ç« èµ·ï¼Œæˆ‘ä»¬å°†æ­£å¼å¼€å¯æ­å»ºä¸€å¥— `CI/CD` æµç¨‹ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œé¦–å…ˆè¦å­¦ä¹ ä¸‹è´¯ç©¿æˆ‘ä»¬å°å†Œå…¨ç¨‹çš„ä¸€ä¸ªæŠ€æœ¯ï¼š`Docker å’Œ Jenkins`


## ä»€ä¹ˆæ˜¯ Docker

`Docker` æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ã€‚å¼€å‘è€…å¯ä»¥å°†è‡ªå·±çš„åº”ç”¨æ‰“åŒ…åœ¨è‡ªå·±çš„é•œåƒé‡Œé¢ï¼Œç„¶åè¿ç§»åˆ°å…¶ä»–å¹³å°çš„ `Docker` ä¸­ã€‚é•œåƒä¸­å¯ä»¥å­˜æ”¾ä½ è‡ªå·±è‡ªå®šä¹‰çš„è¿è¡Œç¯å¢ƒï¼Œæ–‡ä»¶ï¼Œä»£ç ï¼Œè®¾ç½®ç­‰ç­‰å†…å®¹ï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒç¯å¢ƒé€ æˆçš„è¿è¡Œé—®é¢˜ã€‚é•œåƒå…±äº«è¿è¡Œæœºå™¨çš„ç³»ç»Ÿå†…æ ¸ã€‚

åŒæ ·ï¼Œ `Docker` ä¹Ÿæ”¯æŒè·¨å¹³å°ã€‚ä½ çš„é•œåƒä¹Ÿå¯ä»¥åŠ è½½åœ¨ `Windows` å’Œ `Linux`ï¼Œå®ç°å¿«é€Ÿè¿è¡Œå’Œéƒ¨ç½²ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f582c982b59497fa8527d751ca2c2c7~tplv-k3u1fbpfcp-zoom-1.image)

`Docker` çš„ä¼˜åŠ¿åœ¨äº å¿«é€Ÿï¼Œè½»é‡ï¼Œçµæ´»ã€‚å¼€å‘è€…å¯ä»¥åˆ¶ä½œä¸€ä¸ªè‡ªå·±è‡ªå®šä¹‰çš„é•œåƒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®˜æ–¹æˆ–è€…å…¶ä»–å¼€å‘è€…çš„é•œåƒæ¥å¯åŠ¨ä¸€ä¸ªæœåŠ¡ã€‚é€šè¿‡å°†é•œåƒåˆ›å»ºä¸ºå®¹å™¨ï¼Œå®¹å™¨ä¹‹é—´ç›¸äº’éš”ç¦»èµ„æºå’Œè¿›ç¨‹ä¸å†²çªã€‚ä½†ç¡¬ä»¶èµ„æºåˆæ˜¯å…±äº«çš„ã€‚
åˆ›å»ºçš„é•œåƒä¹Ÿå¯ä»¥é€šè¿‡æ–‡ä»¶å¿«é€Ÿåˆ†äº«ï¼Œä¹Ÿå¯ä»¥ä¸Šä¼ åˆ°é•œåƒåº“è¿›è¡Œå­˜å–å’Œç®¡ç†ã€‚åŒæ—¶ `Docker`Â çš„é•œåƒæœ‰ `åˆ†å±‚ç­–ç•¥`Â ï¼Œæ¯æ¬¡å¯¹é•œåƒçš„æ›´æ–°æ“ä½œï¼Œéƒ½ä¼šå †å ä¸€ä¸ªæ–°å±‚ã€‚å½“ä½ æ‹‰å– / æ¨é€æ–°ç‰ˆæœ¬é•œåƒæ—¶ï¼Œåªæ¨é€ / æ‹‰å–ä¿®æ”¹çš„éƒ¨åˆ†ã€‚å¤§å¤§åŠ å¿«äº†é•œåƒçš„ä¼ è¾“æ•ˆç‡


é‚£ä¹ˆ `Docker`Â åœ¨ `CI/CD` ä¸­çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ


`Docker` è´¯ç©¿ `CI/CD` ä¸­æ•´ä¸ªæµç¨‹ã€‚ä½œä¸ºåº”ç”¨æœåŠ¡çš„è½½ä½“æœ‰ç€éå¸¸é‡è¦çš„åœ°ä½ã€‚


æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Docker` å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªé•œåƒï¼Œäº¤ç»™ `Kubernetes` å»éƒ¨ç½²åœ¨ç›®æ ‡æœåŠ¡é›†ç¾¤ã€‚å¹¶ä¸”å¯ä»¥å°†é•œåƒä¸Šä¼ åˆ°è‡ªå·±çš„é•œåƒä»“åº“ï¼Œåšå¥½ç‰ˆæœ¬åˆ†ç±»å¤„ç†ã€‚ 


## å®‰è£… Docker


åœ¨äº†è§£äº† `Docker` çš„ä½œç”¨åï¼Œæˆ‘ä»¬æ¥å¼€å§‹å®‰è£… `Docker`ã€‚åœ¨å¼€å§‹å®‰è£…ä¹‹å‰ï¼Œéœ€è¦å®‰è£… `device-mapper-persistent-data` å’Œ `lvm2` ä¸¤ä¸ªä¾èµ–ã€‚


`device-mapper-persistent-data`Â æ˜¯ `Linux` ä¸‹çš„ä¸€ä¸ªå­˜å‚¨é©±åŠ¨ï¼Œ `Linux`Â ä¸Šçš„é«˜çº§å­˜å‚¨æŠ€æœ¯ã€‚ `Lvm`Â çš„ä½œç”¨åˆ™æ˜¯åˆ›å»ºé€»è¾‘ç£ç›˜åˆ†åŒºã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `CentOS`Â çš„ `Yum` åŒ…ç®¡ç†å™¨å®‰è£…ä¸¤ä¸ªä¾èµ–ï¼š


```shell
yum install -y yum-utils device-mapper-persistent-data lvm2
```


ä¾èµ–å®‰è£…å®Œæ¯•åï¼Œæˆ‘ä»¬å°†é˜¿é‡Œäº‘çš„ `Docker` é•œåƒæºæ·»åŠ è¿›å»ã€‚å¯ä»¥åŠ é€Ÿ `Docker` çš„å®‰è£…ã€‚


```shell
sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum install docker-ce -y
```


å®‰è£…å®Œæ¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `systemctl` å¯åŠ¨æ¥å¯åŠ¨ `Docker` äº†ã€‚`systemctl` æ˜¯ `Linux` çš„è¿›ç¨‹ç®¡ç†æœåŠ¡å‘½ä»¤ï¼Œä»–å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯åŠ¨ `docker`Â 


```shell
systemctl start docker
systemctl enable docker
```


æ¥ç€æ‰§è¡Œä¸€ä¸‹ `docker -v` ï¼Œè¿™æ¡å‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥çœ‹ `Docker` å®‰è£…çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹ `docker`Â å®‰è£…çŠ¶æ€ã€‚å¦‚æœæ­£å¸¸å±•ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œä»£è¡¨ `Docker`Â å·²ç»å®‰è£…æˆåŠŸã€‚


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d98208c9e174be6b0d82acdaa1a2a28~tplv-k3u1fbpfcp-zoom-1.image)


### é…ç½®é˜¿é‡Œäº‘é•œåƒæº


åœ¨ `Docker` å®‰è£…å®Œæ¯•åï¼Œä¹‹åæˆ‘ä»¬å»æ‹‰å– `docker`Â é•œåƒæ—¶ï¼Œä¸€èˆ¬é»˜è®¤ä¼šå» `docker`Â å®˜æ–¹æºæ‹‰å–é•œåƒã€‚ä½†æ˜¯å›½å†…å‡ºæµ·ç½‘é€Ÿå®åœ¨æ˜¯å¤ªæ…¢ï¼Œæ‰€ä»¥é€‰æ‹©æˆ‘ä»¬æ›´æ¢ä¸º `é˜¿é‡Œäº‘é•œåƒä»“åº“` æºè¿›è¡Œé•œåƒä¸‹è½½åŠ é€Ÿã€‚


ç™»å½•é˜¿é‡Œäº‘å®˜ç½‘ï¼Œæ‰“å¼€ [é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡](https://cr.console.aliyun.com)ã€‚ç‚¹å‡»å·¦ä¾§èœå•æœ€ä¸‹é¢çš„ `é•œåƒåŠ é€Ÿå™¨` ï¼Œé€‰æ‹© `CentOS` ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚æŒ‰ç…§å®˜ç½‘çš„æç¤ºæ‰§è¡Œå‘½ä»¤ï¼Œå³å¯æ›´æ¢ `docker` é•œåƒæºåœ°å€ã€‚
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea464ab9fe1941bba822a6131dd631c8~tplv-k3u1fbpfcp-zoom-1.image)


## å®‰è£… Jenkins


åœ¨å®‰è£…å®Œ `Docker` åï¼Œæˆ‘ä»¬åªæ˜¯æ‹¥æœ‰äº†ä¸€ä¸ªå¯ä»¥æ‰¿è½½æœåŠ¡çš„è½½ä½“ã€‚æƒ³å®ç°è‡ªåŠ¨åŒ–æ„å»ºï¼Œè¿˜éœ€è¦å®‰è£…å¦ä¸€ä¸ªæ„å»ºå·¥å…· `Jenkins`ã€‚é‚£ä»€ä¹ˆæ˜¯ `Jenkins` å‘¢ï¼Ÿ


`Jenkins` æ˜¯ä¸€ä¸ªåŸºäº `Java` è¯­è¨€å¼€å‘çš„æŒç»­æ„å»ºå·¥å…·å¹³å°ï¼Œä¸»è¦ç”¨äºæŒç»­ã€è‡ªåŠ¨çš„æ„å»º/æµ‹è¯•ä½ çš„è½¯ä»¶å’Œé¡¹ç›®ã€‚å®ƒå¯ä»¥æ‰§è¡Œä½ é¢„å…ˆè®¾å®šå¥½çš„è®¾ç½®å’Œæ„å»ºè„šæœ¬ï¼Œä¹Ÿå¯ä»¥å’Œ Git ä»£ç åº“åšé›†æˆï¼Œå®ç°è‡ªåŠ¨è§¦å‘å’Œå®šæ—¶è§¦å‘æ„å»ºã€‚


### 1. å®‰è£… OpenJDK


å› ä¸º `Jenkins` æ˜¯ `Java` ç¼–å†™çš„æŒç»­æ„å»ºå¹³å°ï¼Œæ‰€ä»¥å®‰è£… `Java` å¿…ä¸å¯å°‘ã€‚


åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©å®‰è£…å¼€æºçš„ `openjdk`Â å³å¯ã€‚ `openjdk`Â æ˜¯ `SunJDK`Â ä¸€ç§**å¼€æºå®ç°**ã€‚å…³äº`openjdk` æ˜¯ `SunJDK` çš„å…·ä½“åŒºåˆ«å¯ä»¥çœ‹ä¸‹é¢çš„æ–‡ç« äº†è§£ä¸‹ã€‚åœ¨è¿™æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ `yum` åŒ…ç®¡ç†å™¨å®‰è£… `openjdk` å³å¯ã€‚
```shell
yum install -y java
```
> [https://www.zhihu.com/question/19646618](https://www.zhihu.com/question/19646618)



### 2. ä½¿ç”¨ Yum å®‰è£… Jenkins 


ç”±äº `Yum` æºä¸è‡ªå¸¦ `Jenkins` çš„å®‰è£…æºï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦è‡ªå·±å¯¼å…¥ä¸€ä»½ `Jenkins` å®‰è£…æºè¿›è¡Œå®‰è£…ã€‚å¯¼å…¥åï¼Œä½¿ç”¨ `Yum`Â å‘½ä»¤å®‰è£…å³å¯ã€‚
```shell
sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
yum install jenkins
```


### 3. å¯åŠ¨ Jenkins


`Jenkins` å®‰è£…åï¼Œä¼šå°†å¯åŠ¨å‘½ä»¤æ³¨å†Œåˆ°ç³»ç»Ÿ `Service` å‘½ä»¤ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç³»ç»Ÿ `service`Â å‘½ä»¤å¯åŠ¨ `Jenkins`Â å³å¯ã€‚åœ¨è¿™é‡Œï¼Œæœ‰ä¸‰ä¸ªå‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼Œåˆ†åˆ«å¯¹åº” å¯åŠ¨ / é‡å¯ / åœæ­¢ ä¸‰ä¸ªå‘½ä»¤ã€‚


åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨ `service jenkins start`Â å¯åŠ¨ Jenkins å³å¯
```shell
service jenkins start
# service jenkins restart restart é‡å¯ Jenkins
# service jenkins restart stop åœæ­¢ Jenkins
```


### 4. ç»™ Jenkins æ”¾è¡Œç«¯å£


åœ¨å¯åŠ¨ `Jenkins` åï¼Œæ­¤æ—¶ `Jenkins` ä¼šå¼€å¯å®ƒçš„é»˜è®¤ç«¯å£ `8080`Â ã€‚ä½†ç”±äºé˜²ç«å¢™é™åˆ¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®©é˜²ç«å¢™æ”¾è¡Œ `8080` ç«¯å£æ‰èƒ½å¯¹å¤–è®¿é—®åˆ°ç•Œé¢ã€‚


è¿™é‡Œæˆ‘ä»¬åœ¨ `CentOS`Â ä¸‹çš„ `firewall-cmd`Â é˜²ç«å¢™æ·»åŠ ç«¯å£æ”¾è¡Œè§„åˆ™ï¼Œæ·»åŠ å®Œåé‡å¯é˜²ç«å¢™ã€‚
```shell
firewall-cmd --zone=public --add-port=8080/tcp --permanent
firewall-cmd --zone=public --add-port=50000/tcp --permanent

systemctl reload firewalld
```


æœåŠ¡å¯åŠ¨åï¼Œè®¿é—® `IP:8080` ã€‚å¦‚æœèƒ½å¤Ÿçœ‹åˆ°ä»¥ä¸‹ç•Œé¢ï¼Œä»£è¡¨æ­£åœ¨å¯åŠ¨ã€‚ `Jenkins`Â ç¬¬ä¸€æ¬¡çš„å¯åŠ¨æ—¶é—´ä¸€èˆ¬æ¯”è¾ƒé•¿ï¼ˆè§†æœåŠ¡å™¨æ€§èƒ½è€Œçœ‹ï¼‰
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/590e97ce582543dea52a5f90501f5cd1~tplv-k3u1fbpfcp-zoom-1.image)
### 5. åˆå§‹åŒ– Jenkins é…ç½®


#### 5.1 è§£é” Jenkins


åœ¨ `Jenkins` å¯åŠ¨å®Œæˆåï¼Œä¼šè‡ªåŠ¨è·³è½¬è‡³è¿™ä¸ªç•Œé¢ï¼ˆä¸‹æ–¹äºŒå›¾ï¼‰ã€‚è¿™æ˜¯ `Jenkins` çš„è§£é”ç•Œé¢ï¼Œä½ éœ€è¦è¾“å…¥å­˜æ”¾åœ¨æœåŠ¡å™¨çš„åˆå§‹è§£é”å¯†ç æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚


`Jenkins` å¯åŠ¨åï¼Œä¼šç”Ÿæˆä¸€ä¸ª**åˆå§‹å¯†ç **ã€‚è¯¥å¯†ç åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶å†…å­˜æ”¾ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥æœåŠ¡å™¨æŸ¥çœ‹å¯†ç å†…å®¹ï¼Œå°†å¯†ç å¡«å†™åœ¨ `Jenkins` çš„ç®¡ç†å‘˜å¯†ç è¾“å…¥æ¡†å†…ï¼š
```shell
cat /var/lib/jenkins/secrets/initialAdminPassword
```
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/80991521841c4fbfbfc24330e820488c~tplv-k3u1fbpfcp-zoom-1.image)![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48924f5f22e444cf8b61da8466fb228b~tplv-k3u1fbpfcp-zoom-1.image)


ç‚¹å‡» `ç»§ç»­`Â æŒ‰é’®ï¼Œè§£é” Jenkinsã€‚


#### 5.2 ä¸‹è½½æ’ä»¶


è§£é”åå°±æ¥åˆ°äº†æ’ä»¶ä¸‹è½½é¡µé¢ï¼Œè¿™ä¸€æ­¥è¦ä¸‹è½½ä¸€äº› `Jenkins`Â çš„åŠŸèƒ½æ’ä»¶ã€‚
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78b36782863c4d1e9d7e06fad09d2dec~tplv-k3u1fbpfcp-zoom-1.image)
å› ä¸º `Jenkins` æ’ä»¶æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œæ‰€ä»¥é€Ÿåº¦ä¸å¤ªç†æƒ³ã€‚æˆ‘ä»¬éœ€è¦æ›´æ¢ä¸ºæ¸…åå¤§å­¦çš„ `Jenkins`Â æ’ä»¶æºåï¼Œå†å®‰è£…æ’ä»¶ï¼Œ**æ‰€ä»¥å…ˆä¸è¦ç‚¹å®‰è£…æ’ä»¶ã€‚**


æ›´æ¢æ–¹æ³•å¾ˆç®€å•ã€‚è¿›å…¥æœåŠ¡å™¨ï¼Œå°† `/var/lib/jenkins/updates/default.json` å†…çš„æ’ä»¶æºåœ°å€æ›¿æ¢æˆæ¸…åå¤§å­¦çš„æºåœ°å€ï¼Œå°† google æ›¿æ¢ä¸º baidu å³å¯ã€‚
```shell
sed -i 's/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g' /var/lib/jenkins/updates/default.json && sed -i 's/http:\/\/www.google.com/https:\/\/www.baidu.com/g' /var/lib/jenkins/updates/default.json
```
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ec4d971326e4a938596e501dcc92cff~tplv-k3u1fbpfcp-zoom-1.image)


æ¥ç€ç‚¹å‡» `å®‰è£…æ¨èçš„æ’ä»¶`Â å³å¯ã€‚ç¨ç­‰ä¸€ä¼šæ’ä»¶å®‰è£…å®Œæ¯•
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a29085d29f31454d9f4bd0b323f8bc62~tplv-k3u1fbpfcp-zoom-1.image)
### 6. å®Œæˆå®‰è£…


æ’ä»¶å®‰è£…å®Œæ¯•åï¼Œæ¥ç€æ˜¯æ³¨å†Œç®¡ç†å‘˜è´¦å·ã€‚æŒ‰ç…§æç¤ºä¸€è·¯é…ç½®åï¼Œç›´åˆ°çœ‹åˆ°ä»¥ä¸‹ç•Œé¢ä»£è¡¨å®‰è£…æˆåŠŸ
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2bd4415a6da34d05aad501bfd5d5029f~tplv-k3u1fbpfcp-zoom-1.image)


### 7. æµ‹è¯•å®‰è£…


åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ Jenkins ç®—æ˜¯å¯åŠ¨æˆåŠŸäº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹ `Jenkins` åšä¸€ç‚¹ç‚¹ç®€å•çš„é…ç½®ï¼Œæ‰å¯ä»¥è®©å®ƒå¯ä»¥æ„å»º `docker` é•œåƒã€‚


æˆ‘ä»¬ç‚¹å‡» `Jenkins` é¦–é¡µ -> å·¦ä¾§å¯¼èˆª -> æ–°å»ºä»»åŠ¡ -> **Freestyle project**
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4bae87d4a1c4494a0615e6f169d5423~tplv-k3u1fbpfcp-zoom-1.image)


æ–°å»ºå®Œæ¯•åï¼Œæ‰¾åˆ° `æ„å»º` ä¸€é¡¹ï¼Œé€‰æ‹© `å¢åŠ æ„å»ºæ­¥éª¤`ï¼Œé€‰æ‹© `æ‰§è¡Œshell` ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
```shell
docker -v
docker pull node:latest
```


è¯¥å‘½ä»¤ä¼šå»æ‹‰å–ä¸€ä¸ª `nodejs` ç¨³å®šç‰ˆçš„é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯• `Docker` çš„å¯ç”¨æ€§
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/198a7f5fbe0f41e8b663f2c2af425fb2~tplv-k3u1fbpfcp-zoom-1.image)


ä¿å­˜åï¼Œæˆ‘ä»¬ç‚¹å‡»å·¦ä¾§èœå•çš„**ç«‹å³æ„å»º**ï¼Œ `Jenkins` å°±ä¼šå¼€å§‹æ„å»ºã€‚é€‰æ‹©å·¦ä¾§å†å²è®°å½•ç¬¬ä¸€é¡¹ï¼ˆæœ€æ–°çš„ä¸€é¡¹ï¼‰ï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºï¼ŒæŸ¥çœ‹æ„å»ºæ—¥å¿—ã€‚
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a633c410f75c4db8be48133a4a516830~tplv-k3u1fbpfcp-zoom-1.image)
æ‰§è¡Œåï¼Œæˆ‘ä»¬å‘ç°æç¤ºæ— è®¿é—®æƒé™ã€‚è¿™åˆæ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿè¿™é‡Œå°±ä¸å¾—ä¸æåˆ° `Linux` ä¸‹çš„ `Unix Socket`æƒé™é—®é¢˜äº†


### 8. Unix Socket æƒé™é—®é¢˜


`docker` çš„æ¶æ„æ˜¯ `C/S` æ¶æ„ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨ `docker` å‘½ä»¤æ—¶ï¼Œå…¶å®æ˜¯å‘½ä»¤ä½¿ç”¨ `socket`Â ä¸ `docker` çš„å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œæ‰èƒ½æ­£å¸¸æ‰§è¡Œ `docker` å‘½ä»¤ã€‚


è€Œåœ¨ `Linux`Â ä¸­ï¼Œ `Unix socket`Â å±äº `root` ç”¨æˆ·ï¼Œå› æ­¤éœ€è¦ `root`Â æƒé™æ‰èƒ½è®¿é—®ã€‚å®˜æ–¹æ˜¯è¿™ä¹ˆè§£é‡Šçš„ï¼š
> Manage Docker as a non-root user
> The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The docker daemon always runs as the root user.
> If you donâ€™t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group.



ä½†æ˜¯åœ¨ `docker`Â ä¸­ï¼Œ `docker`Â æä¾›äº†ä¸€ä¸ª `ç”¨æˆ·ç»„`Â çš„æ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥å°†æ‰§è¡Œ `Shell`Â çš„ç”¨æˆ·æ·»åŠ åˆ°åç§°ä¸º `docker`Â çš„ç”¨æˆ·ç»„ï¼Œåˆ™å¯ä»¥æ­£å¸¸æ‰§è¡Œ `docker`Â å‘½ä»¤ã€‚


è€Œåœ¨ `Jenkins` ä¸­æ‰§è¡Œçš„ç»ˆç«¯ç”¨æˆ·åš `jenkins`Â ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°† `jenkins`Â åŠ å…¥åˆ° `docker` ç”¨æˆ·ç»„å³å¯ï¼š
```shell
sudo groupadd docker          #æ–°å¢dockerç”¨æˆ·ç»„
sudo gpasswd -a jenkins docker  #å°†å½“å‰ç”¨æˆ·æ·»åŠ è‡³dockerç”¨æˆ·ç»„
newgrp docker                 #æ›´æ–°dockerç”¨æˆ·ç»„
```


åŠ å…¥åï¼Œé‡å¯ `Jenkins`Â ï¼š
```shell
sudo service jenkins restart
```


é‡å¯ `Jenkins`Â åï¼Œå†æ¬¡æ‰§è¡Œè„šæœ¬ã€‚æ­¤æ—¶æ‰§è¡ŒæˆåŠŸï¼š
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebb74deda4d04246922c556f74963413~tplv-k3u1fbpfcp-zoom-1.image)


## ç»“æŸè¯­


åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„åŸºç¡€ç»„ä»¶ â€”â€” `docker`Â å’Œ `Jenkins`Â å°±å®‰è£…å®Œæ¯•äº†ã€‚ä¸è¿‡ï¼Œè¿™åªæ˜¯æŒç»­æ„å»ºçš„ç¬¬ä¸€æ­¥ã€‚åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬ä¼šåœ¨æœåŠ¡å™¨ä¸Šå®‰è£… `Node`Â ç¯å¢ƒï¼Œå¹¶é›†æˆ `Git`Â ä»£ç åº“å®ç°å¯¹ä»£ç çš„é•œåƒæ„å»ºã€‚


å¦‚æœä½ æœ‰ä»€ä¹ˆç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡º ğŸ‘
